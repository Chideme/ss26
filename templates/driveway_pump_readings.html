{% extends "driveway_layout.html" %}




{% block main %}
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
        
        <form role="form" style="display: inline-block;"  action="{{ url_for('end_shift_update') }}" method="post" > 
            <button  class="btn btn-sm btn-outline-secondary" type="submit">Finish Driveway Update</button>      
        </form>
        <div class="btn-toolbar mb-2 mb-md-0">
        
          <div class="btn-group mr-2">
            <button  type="button" id="download" class="btn  btn-outline-secondary"><a href="{{ url_for('driveway_report',shift=shift.id) }}" >View Report</a></button>
          </div>
        </div>
      </div>

    
      
      
      
        
      <button type="submit">Submit form</button>
        <table class="display" id="readings">
          
            <thead>
                
                <th>Pump Name</th>
                <th>Opening Litre Readings</th>
                <th>Closing Litre Readings</th>
                <th>Sales (L)</th>
                <th>Opening Money Readings</th>
                <th>Closing Money Readings</th>
                <th>Sales ($)</th>
            </thead>
            <tbody>
              {%for pump in pumps %}
              <tr>
                
                <td >{{ pump.name }}</td>
                
                <td >{{ pump_readings[pump.name][0][0] }}</td>
                <td><input type="text" id="row-{{ pump.id }}-litre" name="row-{{ pump.id }}-litre"
                    value="{{ pump_readings[pump.name][1][0] }}" class="Closing">
                 
                </td>
                <td></td>
        
            
                
                <td >{{ pump_readings[pump.name][0][1] }}</td>
                <td ><input type="text" id="row-{{ pump.id }}-money" name="row-{{ pump.id }}-money"
                 
                    value="{{ pump_readings[pump.name][1][1] }}">
                  
                </td>
                <td >{{ pump_readings[pump.name][1][1]-pump_readings[pump.name][0][1] }}</td>
              </tr>
              {% endfor %}
              
              </tbody>
            </table>
            <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
            <script>
                 // DataTables function
                $(document).ready(function(){
                    var table = $('#readings').DataTable({
                        dom: '<"pull-left"><"pull-right"B>tip',
                        
                                        

                    });
                
                    $('button').click( function() {
                        var data = table.$('input, select').serializeArray();
                        console.log(data);
                        alert(
                            "The following data would have been submitted to the server: \n\n"+
                            data
                        );
                        $.ajax({
                            "url": "/driveway_pump_litre_readings",
                            "type": "POST",
                            "data": JSON.stringify( data ),
                            "contentType":"application/json"
                    })
                        return true;
                    } );
                            });
                
            </script>
<script>
    var table = document.getElementById("readings");
    
    
        for (var i = 1; i < table.rows.length; i++) {
            table.rows[i].cells[2].addEventListener("input", function () {
                console.log("event works")
                table.rows[i].cells[3].innerHTML = 2;
                
            });

        }
   
</script>
{% endblock %}

